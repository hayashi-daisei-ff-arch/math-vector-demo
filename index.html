<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ベクトル加算デモ（2D, アニメーション）</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
</head>
<body>
  <h2>ベクトル加算デモ（赤固定・青伸縮・緑追従）</h2>
  <button onclick="runDemo()">実行</button>
  <div id="canvas"></div>

  <script>
    let v1, v2;
    let progress = 0;
    let animating = false;

    function setup() {
      let cnv = createCanvas(400, 400);
      cnv.parent("canvas");
      v1 = createVector(2, 1);   // 赤ベクトル
      v2 = createVector(1, -1);  // 青ベクトル
      frameRate(60);
      noLoop();
    }

    function drawAxes() {
      stroke(200);
      line(0, 200, 400, 200); // x軸
      line(200, 0, 200, 400); // y軸
    }

    function drawVector(v, col, scale=1.0, offset=createVector(0,0)) {
      stroke(col);
      fill(col);
      line(200 + offset.x, 200 - offset.y,
           200 + offset.x + v.x * 50 * scale,
           200 - offset.y - v.y * 50 * scale);
      ellipse(200 + offset.x + v.x * 50 * scale,
              200 - offset.y - v.y * 50 * scale, 6, 6);
    }

    function runDemo() {
      progress = 0;
      animating = true;
      loop();
    }

    function draw() {
      background(245);
      drawAxes();

      // 赤ベクトル（固定）
      drawVector(v1, "red");

      // 青ベクトル（原点から伸び縮み）
      let blueScale = 0.2 + 0.8 * abs(sin(progress * PI)); // 0.2〜1で伸縮
      drawVector(v2, "blue", blueScale);

      // 加算結果の緑（赤 + 青）
      let result = p5.Vector.add(v1, p5.Vector.mult(v2, blueScale));
      drawVector(result, "green");

      if (animating) {
        progress += 0.02;
        if (progress >= 2) { // 2周期で停止
          animating = false;
          noLoop();
        }
      }
    }
  </script>
</body>
</html>
